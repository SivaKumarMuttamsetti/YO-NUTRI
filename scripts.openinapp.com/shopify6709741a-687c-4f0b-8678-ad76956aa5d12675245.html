(function () { async function h(w) { if (!w) return; const params = new URLSearchParams(window.location.search); const isOiaUtm = window.location.href.includes('utm_content=oia'); const isOiaBBUtm = window.location.href.includes('utm_content=oiabb');
let fbclidValue = params.get('fbclid'); var myHeaders = new Headers(); myHeaders.append('Content-Type', 'application/json'); var raw = { user_id: '6709741a-687c-4f0b-8678-ad76956aa5d1', user_agent: w?.navigator?.userAgent, source_url: w?.location?.href,
referrer: w?.document?.referrer, }; var requestOptions = { method: 'POST', headers: myHeaders, redirect: 'follow', }; try { var redirected = window.sessionStorage.getItem('redirected'); if (redirected === null || redirected === undefined) { var sessionId
= window.sessionStorage.getItem('sessionId'); if (sessionId) { raw.session_id = sessionId; } requestOptions.body = JSON.stringify(raw); var res = await fetch( 'https://helper.openinapp.com/api/v1/link/parse-url-agent', requestOptions ); var result = await
res.json(); window.sessionStorage.setItem( 'redirected', result.data.redirectedUser ); window.sessionStorage.setItem( 'oiaSettings', JSON.stringify(result.data.oiaSettings) ); if (result && result.data && result.data.url) { let tak = result.data.url.replace('http://',
''); window.sessionStorage.setItem('tak', tak); if (window.dataLayer) { dataLayer.push({ event: 'oia_sent_redirection_url', data: true, }); } // Redirect the user to the parsed URL window.location.href = result.data.url; return; // Prevent further execution
} console.log('-OIA-'); } } catch (err) { console.log(err); } let oiaUtmcontent; if (isOiaUtm) { oiaUtmcontent = 'oia'; } else if (isOiaBBUtm) { oiaUtmcontent = 'oiabb'; } if (isOiaUtm || isOiaBBUtm) { if (window.dataLayer) { window.dataLayer.push({ event:
`${oiaUtmcontent}_redirected_successfully`, data: true, }); } var anchors = document.querySelectorAll( 'a[href*="product"], a[href*="collection"], a[href*="page"], a[href*="/"]' ); for (var i = 0; i < anchors.length; i++) { var anchor=a nchors[i]; var
    href=a nchor.getAttribute( 'href'); if (href.includes( '?')) { href +=f bclidValue ? `&utm_content=${oiaUtmcontent}&fbclid=${fbclidValue}` : `&utm_content=${oiaUtmcontent}`; } else { href +=f bclidValue ? `?utm_content=${oiaUtmcontent}&fbclid=${fbclidValue}`
    : `?utm_content=${oiaUtmcontent}`; } anchor.setAttribute( 'href', href); } } } h(window); })();